## μ „μ²΄ μ„λΉ„μ¤ μ•„ν‚¤ν…μ² λ° ν”λ΅μ°

### 1. μ„λΉ„μ¤ κ°μ” λ° ν•µμ‹¬ κ°€μΉ

**λ―Έκµ­ μ£Όμ‹ O/X μμΈ΅ μ„λΉ„μ¤**λ” μ‚¬μ©μκ°€ λ§¤μΌ μ„ μ •λ λ―Έκµ­ μ£Όμ‹ μΆ…λ©μ— λ€ν•΄ μƒμΉ/ν•λ½μ„ μμΈ΅ν•κ³ , μ •λ‹µμ— λ”°λΌ ν¬μΈνΈλ¥Ό νλ“ν•μ—¬ λ¦¬μ›λ“λ¥Ό κµν™ν•  μ μλ” κ²μ΄λ―Έν”ΌμΌ€μ΄μ… μ„λΉ„μ¤μ…λ‹λ‹¤.

**ν•µμ‹¬ κ°€μΉμ μ•:**

- **κ°„λ‹¨ν• μ°Έμ—¬**: λ§¤μΌ 100κ° μΆ…λ©μ— λ€ν• λ‹¨μν• O/X μ„ νƒ
- **κ³µμ •ν• μ •μ‚°**: EOD(μ¥ λ§κ°) κ°€κ²© κΈ°μ¤€ μλ™ μ •μ‚°
- **λ³΄μƒ μ‹μ¤ν…**: μμΈ΅ μ„±κ³µ μ‹ ν¬μΈνΈ μ§€κΈ‰, λ¦¬μ›λ“ κµν™ κ°€λ¥
- **μ„±μ¥ μ”μ†**: κ΄‘κ³  μ‹μ²­μ„ ν†µν• μ¶”κ°€ μμΈ΅ κΈ°ν μ κ³µ

### 2. μ „μ²΄ μ‹μ¤ν… μ•„ν‚¤ν…μ²

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   Client Apps   β”‚    β”‚   API Gateway   β”‚    β”‚   FastAPI App   β”‚
β”‚  (Web/Mobile)   β”‚β—„β”€β”€β–Ίβ”‚                 β”‚β—„β”€β”€β–Ίβ”‚  (Main Service) β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                                        β”‚
                       β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”              β”‚
                       β”‚   OAuth APIs    β”‚β—„β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
                       β”‚ (Google/Kakao)  β”‚              β”‚
                       β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”              β”‚
                                                        β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”              β”‚
β”‚  Batch          β”‚β—„β”€β”€β–Ίβ”‚   Message Queue β”‚β—„β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ (EOD/Settlement)β”‚    β”‚   (AWS SQS)     β”‚              β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”              β”‚
                                                        β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”              β”‚
β”‚  External APIs  β”‚β—„β”€β”€β–Ίβ”‚   PostgreSQL    β”‚β—„β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   (Yahoo)       β”‚    β”‚ (crypto schema) β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### 3. λ°μ΄ν„° λ¨λΈ λ° ν•µμ‹¬ μ—”ν‹°ν‹°

**ν•µμ‹¬ λ„λ©”μΈ κ°μ²΄:**

- **User**: OAuth κΈ°λ° μ‚¬μ©μ (Google/Kakao λ΅κ·ΈμΈ)
- **Session**: μΌμΌ μμΈ΅ μ„Έμ… (OPEN/CLOSED μƒνƒ)
- **Universe**: μΌμΌ μ„ μ • μΆ…λ© (~100κ°)
- **Prediction**: μ‚¬μ©μ μμΈ΅ (μƒμΉ/ν•λ½)
- **Settlement**: μ •μ‚° κ²°κ³Ό (μ •λ‹µ/μ¤λ‹µ/VOID)
- **Points**: ν¬μΈνΈ μ›μ¥ (λ©±λ“±μ„± λ³΄μ¥)
- **Reward**: λ¦¬μ›λ“ μΉ΄νƒλ΅κ·Έ λ° κµν™

**λ°μ΄ν„° κ΄€κ³„:**

```
User β”€β”€β”¬β”€β–Ί Prediction β”€β”€β–Ί Settlement β”€β”€β–Ί Points β”€β”€β–Ί Reward Redemption
       β””β”€β–Ί AdUnlock (κ΄‘κ³  μ‹μ²­) β”€β”€β–Ί Additional Prediction Slots
```

### 4. μƒμ„Έ μ‚¬μ©μ ν”λ΅μ°

#### 4.1 μ‚¬μ©μ μ¨λ³΄λ”© λ° μΈμ¦

```mermaid
graph TD
    A[μ‚¬μ©μ μ ‘μ†] --> B[OAuth λ΅κ·ΈμΈ μ„ νƒ]
    B --> C[Google/Kakao μΈμ¦]
    C --> D[JWT ν† ν° λ°κΈ‰]
    D --> E[μ‚¬μ©μ μ„Έμ… μƒμ„±]
    E --> F[μ‹ κ· κ°€μ…μ 1000ν¬μΈνΈ μ§€κΈ‰]
```

```
  μ‹¤μ  API μ—”λ“ν¬μΈνΈ:

  | ν”λ΅μ° λ‹¨κ³„        | API μ—”λ“ν¬μΈνΈ                                  | νμΌ μ„μΉ              | μƒνƒ    |
  |----------------|-----------------------------------------------|----------------------|-------|
  | OAuth μΈμ¦ μ‹μ‘   | GET /auth/oauth/{provider}/authorize         | auth_router.py:30    | β… μ™„λ²½ |
  | OAuth μ½λ°± μ²λ¦¬   | GET /auth/oauth/{provider}/callback          | auth_router.py:90    | β… μ™„λ²½ |
  | ν”„λ΅κ·Έλ¨ μ½λ°± API  | POST /auth/oauth/callback                    | auth_router.py:154   | β… μ™„λ²½ |
  | JWT ν† ν° κ°±μ‹     | POST /auth/token/refresh                     | auth_router.py:191   | β… μ™„λ²½ |
  | λ΅κ·Έμ•„μ›ƒ         | POST /auth/logout                            | auth_router.py:224   | β… μ™„λ²½ |
  | **μ‹ κ· κ°€μ… λ³΄λ„μ¤** | **1000ν¬μΈνΈ μλ™ μ§€κΈ‰** (OAuth μ½λ°± λ‚΄λ¶€ μ²λ¦¬)     | auth_service.py:141  | β… **μ‹ κ·** |
  | **μ‚¬μ©μ μƒμ„±**    | **OAuth μ‚¬μ©μ μƒμ„±** (λ©±λ“±μ„± λ³΄μ¥)              | user_repository.py   | β… **μ‹ κ·** |
  | **λ‹‰λ„¤μ„ μ¤‘λ³µμ²λ¦¬** | **μλ™ μ¤‘λ³µ ν•΄κ²°** (name_1, name_2...)        | auth_service.py:122  | β… **μ‹ κ·** |

#### 4.1.2 μ‚¬μ©μ κ΄€λ¦¬ API (User Router)
```

μ‚¬μ©μ ν”„λ΅ν•„ κ΄€λ¦¬ λ° ν¬μΈνΈ μ—°λ™ API:

| κΈ°λ¥ λ¶„λ¥           | API μ—”λ“ν¬μΈνΈ                          | νμΌ μ„μΉ          | μƒνƒ          |
| ------------------- | --------------------------------------- | ------------------ | ------------- |
| **λ‚΄ ν”„λ΅ν•„ μ΅°ν**  | GET /users/me                           | user_router.py:22  | β… μ™„λ²½       |
| **λ‚΄ ν”„λ΅ν•„ μμ •**  | PUT /users/me                           | user_router.py:45  | β… μ™„λ²½       |
| **μ‚¬μ©μ μ΅°ν**     | GET /users/{user_id}                    | user_router.py:81  | β… μ™„λ²½       |
| **μ‚¬μ©μ λ©λ΅**     | GET /users/                             | user_router.py:118 | β… μ™„λ²½       |
| **λ‹‰λ„¤μ„ κ²€μƒ‰**     | GET /users/search/nickname?q={nickname} | user_router.py:154 | β… μ™„λ²½       |
| **κ³„μ • λΉ„ν™μ„±ν™”**   | DELETE /users/me                        | user_router.py:269 | β… μ™„λ²½       |
| **μ΄λ©”μΌ μ¤‘λ³µν™•μΈ** | POST /users/validate/email              | user_router.py:221 | β… μ™„λ²½       |
| **λ‹‰λ„¤μ„ μ¤‘λ³µν™•μΈ** | POST /users/validate/nickname           | user_router.py:244 | β… μ™„λ²½       |
| **μ‚¬μ©μ ν†µκ³„**     | GET /users/stats/overview               | user_router.py:194 | β… **κ΄€λ¦¬μ** |

#### 4.1.3 ν¬μΈνΈ μ—°λ™ API (User + Points)

```
  μ‚¬μ©μλ³„ ν¬μΈνΈ κ΄€λ¦¬ API:

  | κΈ°λ¥ λ¶„λ¥           | API μ—”λ“ν¬μΈνΈ                               | νμΌ μ„μΉ                | μƒνƒ    |
  |------------------|---------------------------------------------|------------------------|-------|
  | **λ‚΄ ν¬μΈνΈ μ”μ•΅**    | GET /users/me/points/balance               | user_router.py:303     | β… μ™„λ²½ |
  | **λ‚΄ ν¬μΈνΈ λ‚΄μ—­**    | GET /users/me/points/ledger                | user_router.py:324     | β… μ™„λ²½ |
  | **ν”„λ΅ν•„+ν¬μΈνΈ**     | GET /users/me/profile-with-points          | user_router.py:355     | β… μ™„λ²½ |
  | **μ¬μ • μ”μ•½**       | GET /users/me/financial-summary            | user_router.py:374     | β… μ™„λ²½ |
  | **μ§€λ¶ κ°€λ¥ μ—¬λ¶€**    | GET /users/me/can-afford/{amount}          | user_router.py:393     | β… μ™„λ²½ |
```

#### 4.2 μΌμΌ μμΈ΅ μ°Έμ—¬ ν”λ΅μ°

```mermaid
graph TD
    A[λ©”μΈ νμ΄μ§€ μ ‘μ†] --> B[ν„μ¬ μ„Έμ… μƒνƒ ν™•μΈ]
    B --> C{μ„Έμ… μƒνƒ ν™•μΈ}
    C -->|OPEN| D[μ¤λμ μΆ…λ© 100κ° μ΅°ν]
    C -->|CLOSED| E[μμΈ΅ λ§κ° μ•λ‚΄]

    D --> G[μ‚¬μ©μ μμΈ΅ μ¬λ΅― ν™•μΈ]
    G --> H{μ¬λ΅― μ—¬λ¶€}
    H -->|μμ| I[μΆ…λ© μ„ νƒ λ° μμΈ΅ μ μ¶]
    H -->|μ—†μ| J[κ΄‘κ³  μ‹μ²­ λλ” μΏ¨λ‹¤μ΄ λ€κΈ°]

    I --> L[μμΈ΅ μ €μ¥ λ° ν™•μΈ]

    J --> M[κ΄‘κ³  μ‹μ²­ μ™„λ£]
    M --> N[μ¶”κ°€ μ¬λ΅― 1κ° νλ“]
    N --> I
```

```
  μ‹¤μ  API μ—”λ“ν¬μΈνΈ:

  | ν”λ΅μ° λ‹¨κ³„      | API μ—”λ“ν¬μΈνΈ                           | νμΌ μ„μΉ                   |
  |-------------|-------------------------------------|-------------------------|
  | μ„Έμ… μƒνƒ ν™•μΈ    | GET /session/today                  | session_router.py:21    |
  | μμΈ΅ κ°€λ¥ μ—¬λ¶€ μ²΄ν¬ | GET /session/can-predict            | session_router.py:170   |
  | κ°€κ²© μ •λ³΄ ν¬ν•¨ μ΅°ν | GET /universe/today/with-prices     |                        |
 | μ¤λμ μΆ…λ© μ΅°ν   | GET /universe/today                 | universe_router.py:20   |
  | μμΈ΅ μ μ¶       | POST /predictions/{symbol}          | prediction_router.py:29 |
  | μμΈ΅ μμ •       | PUT /predictions/{prediction_id}    | prediction_router.py:66 |
  | μμΈ΅ μ·¨μ†       | DELETE /predictions/{prediction_id} | prediction_router.py:96 |
  | μ¬λ΅― μ •λ³΄ μ΅°ν    | GET /ads/available-slots            | ad_unlock_router.py:183 |
  | κ΄‘κ³  μ‹μ²­ μ™„λ£    | POST /ads/watch-complete            | ad_unlock_router.py:54  |
  | μΏ¨λ‹¤μ΄ μ¬λ΅― ν•΄μ    | POST /ads/unlock-slot               | ad_unlock_router.py:121 |
```

#### 4.3 μ •μ‚° λ° λ³΄μƒ ν”λ΅μ°

```mermaid
graph TD
    A[23:59 KST μμΈ΅ λ§κ°] --> B[06:00 KST EOD λ°μ΄ν„° μμ§‘, EOD DB μ €μ¥]
    B --> C[μ •μ‚° λ΅μ§ μ‹¤ν–‰]
    C --> D{μμΈ΅ κ²°κ³Ό}
    D -->|μ •λ‹µ| E[50ν¬μΈνΈ μ§€κΈ‰]
    D -->|μ¤λ‹µ| F[ν¬μΈνΈ μ—†μ]

    E --> H[ν¬μΈνΈ μ›μ¥ μ—…λ°μ΄νΈ]
    F --> H
    G --> H
    H --> I[μ‚¬μ©μ μ•λ¦Ό λ°μ†΅]
```

#### 4.4 λ¦¬μ›λ“ κµν™ ν”λ΅μ°

```mermaid
graph TD
    A[λ¦¬μ›λ“ μΉ΄νƒλ΅κ·Έ μ΅°ν] --> B[μ›ν•λ” μƒν’ μ„ νƒ]
    B --> C{ν¬μΈνΈ μ”μ•΅ ν™•μΈ}
    C -->|μ¶©λ¶„| E[ν¬μΈνΈ μ°¨κ° λ° κµν™ μ”μ²­]
    E --> F[μ™Έλ¶€ λ²¤λ” λ°κΈ‰ μ”μ²­]
    F --> G{λ°κΈ‰ μ„±κ³µ}
    G -->|μ„±κ³µ| H[κµν™ μ™„λ£ μ•λ¦Ό]
    G -->|μ‹¤ν¨| I[ν¬μΈνΈ ν™λ¶]
```

| ν”λ΅μ° λ‹¨κ³„        | API μ—”λ“ν¬μΈνΈ                                  | νμΌ μ„μΉ                | μƒνƒ        |
| ------------------ | ----------------------------------------------- | ------------------------ | ----------- |
| μλ™ μ •μ‚°          | POST /admin/settlement/settle-day/{trading_day} | settlement_router.py:18  | β… μ™„λ²½     |
| μ •μ‚° μ”μ•½          | GET /admin/settlement/summary/{trading_day}     | settlement_router.py:48  | β… μ™„λ²½     |
| μλ™ μ •μ‚°          | POST /admin/settlement/manual-settle            | settlement_router.py:78  | β… μ™„λ²½     |
| **μ •μ‚° μƒνƒ μ΅°ν** | GET /settlement/status/{trading_day}            | settlement_router.py:120 | β… **μ‹ κ·** |
| **μ •μ‚° μ¬μ‹λ„**    | POST /admin/settlement/retry/{trading_day}      | settlement_router.py:152 | β… **μ‹ κ·** |
| EOD κ°€κ²© μ΅°ν      | GET /prices/eod/{symbol}/{trading_day}          | -                        | β… κµ¬ν„λ¨   |
| ν¬μΈνΈ μ”μ•΅        | GET /points/balance                             | point_router.py:57       | β… μ™„λ²½     |
| ν¬μΈνΈ λ‚΄μ—­        | GET /points/ledger                              | point_router.py:93       | β… μ™„λ²½     |
| **ν¬μΈνΈ μ •ν•©μ„±**  | GET /points/admin/integrity/daily/{trading_day} | point_router.py:499      | β… **μ‹ κ·** |
| λ¦¬μ›λ“ μΉ΄νƒλ΅κ·Έ    | GET /rewards/catalog                            | reward_router.py:34      | β… μ™„λ²½     |
| λ¦¬μ›λ“ κµν™        | POST /rewards/redeem                            | reward_router.py:72      | β… μ™„λ²½     |
| κµν™ λ‚΄μ—­          | GET /rewards/my-redemptions                     | reward_router.py:97      | β… μ™„λ²½     |
| **λ°°μΉ μ‘μ—… μƒνƒ** | GET /batch/jobs/status                          | batch_router.py:425      | β… **μ‹ κ·** |
| **λ°°μΉ κΈ΄κΈ‰μ¤‘λ‹¨**  | POST /batch/emergency-stop                      | batch_router.py:501      | β… **μ‹ κ·** |

### 5. μ‹μ¤ν… λ°°μΉ λ° μλ™ν™” ν”λ΅μ°

#### 5.1 μΌμΌ λ°°μΉ μ¤μΌ€μ¤„ (KST κΈ°μ¤€)

```
06:00 - μΌμΌ μΆ…λ© μ„ μ • λ°°μΉ μ‹¤ν–‰
     β””β”€β–Ί μΈκΈ° λ―Έκµ­ μ£Όμ‹ 100κ° μ„ μ •
     β””β”€β–Ί active_universe ν…μ΄λΈ” μ—…λ°μ΄νΈ

06:00 - μ •μ‚° λ° μƒ μ„Έμ… μ‹μ‘ λ°°μΉ
     β”β”€β–Ί EOD κ°€κ²© λ°μ΄ν„° μμ§‘ (Yahoo Finance)
     β”β”€β–Ί EOD κ°€κ²© λ°μ΄ν„° DBμ €μ¥
     β”β”€β–Ί μ „μΌ μμΈ΅ μ •μ‚° μ‹¤ν–‰ (μ •λ‹µ/μ¤λ‹µ/VOID νμ •)
     β”β”€β–Ί ν¬μΈνΈ μ§€κΈ‰ μ²λ¦¬ (μΉλ¦¬μ‹ 100pt, μ‹¤ν¨μ‹ 0pt, λ¬΄ν¨μ‹ ν™λ¶)
     β””β”€β–Ί μƒ μμΈ΅ μ„Έμ… OPEN μƒνƒλ΅ μ „ν™

23:59 - μμΈ΅ λ§κ° λ°°μΉ
     β””β”€β–Ί ν„μ¬ μμΈ΅ μ„Έμ… CLOSED μƒνƒλ΅ μ „ν™
```

#### 5.2 SQS κΈ°λ° λΉ„λ™κΈ° μ²λ¦¬

```
μ‚¬μ©μ μμΈ΅ μ μ¶ β†’ SQS Queue
EOD λ°μ΄ν„° μμ§‘ β†’ SQS Queue
μ •μ‚° μ™„λ£ β†’ SQS Queue
λ¦¬μ›λ“ κµν™ β†’ SQS Queue
```

### 6. κ³ κΈ‰ κΈ°λ¥ λ° κ²μ΄λ―Έν”ΌμΌ€μ΄μ…

#### 6.1 κ΄‘κ³  μ‹μ¤ν… λ° μ¬λ΅― κ΄€λ¦¬

```
κΈ°λ³Έ μμΈ΅ μ¬λ΅―: 3κ°/μΌ
κ΄‘κ³  μ‹μ²­μ‹: +1μ¬λ΅― (μµλ€ 10κ°/μΌ)
μλ™ μΏ¨λ‹¤μ΄: 5λ¶„λ§λ‹¤ μλ™ +1μ¬λ΅― (μ¬λ΅― < 3κ°μΌ λ•)
```

#### 6.1.1 μλ™ μΏ¨λ‹¤μ΄ μ‹μ¤ν… (μ‹ κ·)

```mermaid
graph TD
    A[μμΈ΅ μ μ¶] --> B{ν„μ¬ μ¬λ΅― < 3?}
    B -->|Yes| C{ν™μ„± μΏ¨λ‹¤μ΄ μλ‚?}
    B -->|No| Z[μΆ…λ£]
    C -->|No| D[μΏ¨λ‹¤μ΄ νƒ€μ΄λ¨Έ DB μ €μ¥]
    C -->|Yes| Z
    D --> E[EventBridge 5λ¶„ μ¤μΌ€μ¤„ μƒμ„±]
    E --> F[5λ¶„ ν›„ SQS λ©”μ‹μ§€ μ „μ†΅]
    F --> G[μ›μ»¤κ°€ μ¬λ΅― +1 μ²λ¦¬]
    G --> H{μ•„μ§ μ¬λ΅― < 3?}
    H -->|Yes| D
    H -->|No| I[μΏ¨λ‹¤μ΄ μΆ…λ£]
```

**κΈ°μ  μ¤νƒ:**
- **DB**: `cooldown_timers` ν…μ΄λΈ” (μƒνƒ κ΄€λ¦¬)
- **μ¤μΌ€μ¤„λ§**: AWS EventBridge one-time rules
- **λ©”μ‹μ§•**: SQS FIFO ν (λ©±λ“±μ„± λ³΄μ¥)
- **νΈλ¦¬κ±°**: μμΈ΅ μ μ¶ ν›„ν›…, μ¬λ΅― μ΅°κ±΄ μ²΄ν¬

#### 6.2 ν¬μΈνΈ κ²½μ  μ‹μ¤ν…

```
μ‹ κ· κ°€μ…: +1000 ν¬μΈνΈ
μ •λ‹µ λ³΄μƒ: +50 ν¬μΈνΈ/κ±΄
λ¦¬μ›λ“ κµν™: -ν¬μΈνΈ (μƒν’λ³„ μ°¨λ“±)
```

### 7. κΈ°μ μ  νΉμ§• λ° μ•μ •μ„±

#### 7.1 λ°μ΄ν„° μ •ν•©μ„± λ³΄μ¥

- **λ©±λ“±μ„± λ³΄μ¥**: ν¬μΈνΈ μ§€κΈ‰/μ°¨κ°μ— ref_id κΈ°λ° μ¤‘λ³µ λ°©μ§€
- **νΈλμ­μ… κ΄€λ¦¬**: ACID μ†μ„± λ³΄μ¥μΌλ΅ λ°μ΄ν„° μΌκ΄€μ„± μ μ§€
- **κ°μ‚¬ λ΅κ·Έ**: λ¨λ“  ν¬μΈνΈ λ³€λ™ λ‚΄μ—­ μ¶”μ 
- **μ •ν•©μ„± κ²€μ¦**: μΌμΌ ν¬μΈνΈ μ΄ν•© κ²€μ¦ λ°°μΉ

#### 7.2 μ„±λ¥ λ° ν™•μ¥μ„±

- **Connection Pooling**: PostgreSQL μ—°κ²° μµμ ν™”
- **λ μ΄νΈ λ¦¬λ°‹**: λ¶„λ‹Ή/μ‹κ°„λ‹Ή API νΈμ¶ μ ν•
- **μΈλ±μ¤ μµμ ν™”**: ν•µμ‹¬ μΏΌλ¦¬ μ„±λ¥ ν–¥μƒ
- **SQS ν**: λΉ„λ™κΈ° μ²λ¦¬λ΅ μ‘λ‹µμ„± κ°μ„ 

#### 7.3 λ¨λ‹ν„°λ§ λ° μ΄μ

- **λΉ„μ¦λ‹μ¤ λ©”νΈλ¦­**: DAU, μμΈ΅ μ°Έμ—¬μ¨, μΉλ¥ , ν¬μΈνΈ μν™μ¨
- **μ‹μ¤ν… λ©”νΈλ¦­**: API μ‘λ‹µμ‹κ°„, DB μ„±λ¥, ν μ²λ¦¬λ‰
- **μ•λ¦Ό μ‹μ¤ν…**: λ°°μΉ μ‹¤ν¨, λ°μ΄ν„° μ΄μƒ, λ³΄μ• μ„ν‘ κ°μ§€
- **κ΄€λ¦¬μ λ„κµ¬**: μΆ…λ© κ΄€λ¦¬, ν¬μΈνΈ μ΅°μ •, λ¦¬μ›λ“ κ΄€λ¦¬

### 8. λ³΄μ• λ° μ»΄ν”λΌμ΄μ–Έμ¤

#### 8.1 μΈμ¦ λ° κ¶ν• κ΄€λ¦¬

- **OAuth 2.0**: Google/Kakao μ•μ „ν• λ΅κ·ΈμΈ
- **JWT ν† ν°**: RS256 μ•κ³ λ¦¬μ¦ κΈ°λ° λ¬΄μƒνƒ μΈμ¦
- **κ΄€λ¦¬μ κ¶ν•**: MFA μ μ©, κ¶ν•λ³„ API μ ‘κ·Ό μ μ–΄

#### 8.2 λ°μ΄ν„° λ³΄νΈ

- **κ°μΈμ •λ³΄ μµμ†ν™”**: ν•„μ μ •λ³΄λ§ μμ§‘
- **μ•”νΈν™”**: λ―Όκ° λ°μ΄ν„° AES-256 μ•”νΈν™”
- **κ°μ‚¬ μ¶”μ **: λ¨λ“  κ΄€λ¦¬μ μ‘μ—… λ΅κΉ…

### 9. μ‚¬μ©μ μΈ΅λ©΄ μƒμ„Έ ν”λ΅μ°

1. **μ‚¬μ©μ μ ‘μ† λ° μΈμ¦**

   - μ›Ή/λ¨λ°”μΌ μ•± μ ‘μ†
   - OAuth (Google/Kakao) λ΅κ·ΈμΈ
   - JWT ν† ν° κΈ°λ° μ„Έμ… κ΄€λ¦¬

2. **μμΈ΅ μ°Έμ—¬ κ³Όμ •**

   - ν„μ¬ μ„Έμ… μƒνƒ ν™•μΈ (OPEN/CLOSED)
   - μ¤λμ μΆ…λ© 100κ° μ΅°ν
   - μ‚¬μ©μ μμΈ΅ μ¬λ΅― ν™•μΈ (κΈ°λ³Έ 3κ°, κ΄‘κ³ μ‹μ²­μΌλ΅ μµλ€ 7κ°)
   - μμΈ΅ μ μ¶ (μƒμΉ/ν•λ½ μ„ νƒ)

3. **μ¶”κ°€ κΈ°ν νλ“**

   - μ¬λ΅― μ†μ§„μ‹ κ΄‘κ³  μ‹μ²­ μ λ„
   - κ΄‘κ³  μ‹μ²­ μ™„λ£ ν›„ μ¶”κ°€ μ¬λ΅― 1κ° νλ“
   - μΏ¨λ‹¤μ΄ μ‹μ¤ν… (5λ¶„ λ€κΈ°) ν™μ©

4. **ν¬μΈνΈ λ° λ¦¬μ›λ“ ν™μ©**
   - ν¬μΈνΈ μ”μ•΅ λ° λ‚΄μ—­ μ΅°ν
   - λ¦¬μ›λ“ μΉ΄νƒλ΅κ·Έ νƒμƒ‰
   - ν¬μΈνΈλ΅ μƒν’ κµν™

### 10. μ‹μ¤ν… μΈ΅λ©΄ μƒμ„Έ ν”λ΅μ°

1. **μΌμΌ μ‚¬μ΄ν΄ κ΄€λ¦¬**

   - [05:30 KST] μΌμΌ μΆ…λ© μ„ μ • λ° λ°μ΄ν„° μ¤€λΉ„
   - [06:00 KST] μ „μΌ μ •μ‚° + μƒ μ„Έμ… OPEN μƒνƒ μ „ν™
   - [06:00-22:00] μ‚¬μ©μ μμΈ΅ μ μ¶ ν™μ„±ν™” κΈ°κ°„
   - [23:59 KST] μμΈ΅ λ§κ°, CLOSED μƒνƒ μ „ν™
   - [23:59-06:00] μ •μ‚° λ€κΈ° λ° μ²λ¦¬

2. **λ°μ΄ν„° μ²λ¦¬ νμ΄ν”„λΌμΈ**

   - EOD κ°€κ²© λ°μ΄ν„° μ™Έλ¶€ API μμ§‘ (Yahoo Finance)
   - κ°€κ²© λ³€λ™λ¥  κ³„μ‚° ν›„ μ‚¬μ©μ μμΈ΅κ³Ό λΉ„κµν•μ—¬ μ •λ‹µ/μ¤λ‹µ/VOID νμ •
   - μ‚¬μ©μλ³„ μμΈ΅ κ²°κ³Ό λ§¤μΉ­
   - ν¬μΈνΈ μ§€κΈ‰/ν™λ¶ μ²λ¦¬ (λ©±λ“±μ„± λ³΄μ¥)

3. **λ°±κ·ΈλΌμ΄λ“ μ‘μ—… μ²λ¦¬**
   - SQS ν κΈ°λ° λΉ„λ™κΈ° μ‘μ—… μ²λ¦¬
   - λ°°μΉ μ‘μ—… λ¨λ‹ν„°λ§ λ° μ‹¤ν¨ μ²λ¦¬
   - λ°μ΄ν„° μ •ν•©μ„± κ²€μ¦ (μΌμΌ μ‹¤ν–‰)
   - μ‹μ¤ν… ν—¬μ¤ μ²΄ν¬ λ° μ•λ¦Ό

μ΄μ™€ κ°™μ΄ μ „μ²΄μ μΌλ΅ **μ‚¬μ©μ μ¤‘μ‹¬μ κ²μ΄λ―Έν”ΌμΌ€μ΄μ…**κ³Ό **μ‹μ¤ν…μ μ•μ •μ„± λ° ν™•μ¥μ„±**μ„ λ¨λ‘ κ³ λ ¤ν• μΆ…ν•©μ μΈ O/X μμΈ΅ μ„λΉ„μ¤ μ•„ν‚¤ν…μ²λ¥Ό κµ¬μ¶•ν•μ—¬, λ‹¨μν•λ©΄μ„λ„ μ¤‘λ…μ„± μλ” μ‚¬μ©μ κ²½ν—κ³Ό μ‹ λΆ°ν•  μ μλ” ν¬μΈνΈ κ²½μ  μ‹μ¤ν…μ„ μ κ³µν•©λ‹λ‹¤.

---

## π“‹ **μ•„ν‚¤ν…μ² λ¶„μ„ κ²°κ³Ό** (2025-08-27)

### β… **μ™„λ²½ν•κ² κµ¬ν„λ μ•„ν‚¤ν…μ²**

**1. 3κ³„μΈµ μ•„ν‚¤ν…μ² μ™„μ „ κµ¬ν„**

- **Services**: 11κ° μ„λΉ„μ¤ (auth, user, session, universe, prediction, price, settlement, point, reward, ad_unlock, aws)
- **Repositories**: 9κ° λ¦¬ν¬μ§€ν† λ¦¬ (user, session, active_universe, prediction, points, rewards, ad_unlock, oauth_state, base)
- **Routers**: 12κ° λΌμ°ν„° (auth, user, session, universe, prediction, price, settlement, batch, point, reward, ad_unlock)

**2. ν•µμ‹¬ λ„λ©”μΈ 100% μ»¤λ²„**

- User (OAuth μ „μ©), Session, Universe, Prediction, Settlement, Points, Rewards, AdUnlock
- μμ΅΄μ„± μ£Όμ…μ„ ν†µν• μ™„λ²½ν• κ³„μΈµ λ¶„λ¦¬
- κ΄€λ¦¬μ κ¶ν• μ‹μ¤ν… κµ¬ν„ μ™„λ£

### π”¥ **μ™„λ²½ν• API μ—”λ“ν¬μΈνΈ λ§¤ν•‘**

#### **4.1 μ‚¬μ©μ μ¨λ³΄λ”© λ° μΈμ¦**

```
OAuth λ΅κ·ΈμΈ β†’ JWT ν† ν° λ°κΈ‰ β†’ μ‹ κ· κ°€μ…μ 1000ν¬μΈνΈ λ³΄λ„μ¤
```

**API μ—”λ“ν¬μΈνΈ:**

- `GET /auth/oauth/{provider}/authorize` - OAuth μΈμ¦ μ‹μ‘
- `GET /auth/oauth/{provider}/callback` - OAuth μ½λ°± μ²λ¦¬
- `POST /auth/token/refresh` - JWT ν† ν° κ°±μ‹ 
- `POST /auth/logout` - λ΅κ·Έμ•„μ›ƒ

#### **4.2 μΌμΌ μμΈ΅ μ°Έμ—¬**

```
μ„Έμ… μƒνƒ ν™•μΈ β†’ μ λ‹λ²„μ¤ μ΅°ν β†’ μμΈ΅ μ¬λ΅― ν™•μΈ β†’ μμΈ΅ μ μ¶
```

**API μ—”λ“ν¬μΈνΈ:**

- `GET /session/today` - ν„μ¬ μ„Έμ… μƒνƒ ν™•μΈ
- `GET /session/can-predict` - μμΈ΅ κ°€λ¥ μ—¬λ¶€ μ²΄ν¬
- `GET /universe/today` - μ¤λμ μΆ…λ© 100κ° μ΅°ν
- `GET /universe/today/with-prices` - κ°€κ²© μ •λ³΄ ν¬ν•¨ μΆ…λ© μ΅°ν (μμΈ΅ μ§€μ›)
- `POST /predictions/{symbol}` - μμΈ΅ μ μ¶ (μƒμΉ/ν•λ½)
- `PUT /predictions/{symbol}` - μμΈ΅ μμ •
- `DELETE /predictions/{symbol}` - μμΈ΅ μ·¨μ†

#### **4.3 κ΄‘κ³  μ‹μ²­ λ° μ¬λ΅― μ¦κ°€**

```
μ¬λ΅― μ†μ§„ β†’ κ΄‘κ³  μ‹μ²­ β†’ μ¶”κ°€ μ¬λ΅― 1κ° νλ“
```

**API μ—”λ“ν¬μΈνΈ:**

- `GET /ads/available-slots` - μ‚¬μ© κ°€λ¥ν• μ¬λ΅― μ •λ³΄
- `POST /ads/watch-complete` - κ΄‘κ³  μ‹μ²­ μ™„λ£ μ²λ¦¬
- `POST /ads/unlock-slot` - μΏ¨λ‹¤μ΄μ„ ν†µν• μ¬λ΅― ν•΄μ 
- `GET /ads/history` - κ΄‘κ³  ν•΄μ  νμ¤ν† λ¦¬

#### **4.4 μ •μ‚° λ° λ³΄μƒ μ‹μ¤ν…**

```
23:59 μμΈ΅ λ§κ° β†’ 06:00 EOD μμ§‘ β†’ μ •μ‚° μ‹¤ν–‰ β†’ 50ν¬μΈνΈ μ§€κΈ‰
```

**API μ—”λ“ν¬μΈνΈ:**

- `POST /admin/settlement/settle-day/{trading_day}` - μλ™ μ •μ‚° μ‹¤ν–‰
- `GET /admin/settlement/summary/{trading_day}` - μ •μ‚° μ”μ•½
- `POST /admin/settlement/manual-settle` - μλ™ μ •μ‚°
- `GET /prices/eod/{symbol}/{trading_day}` - EOD κ°€κ²© μ΅°ν
- `GET /prices/current/{symbol}` - μ‹¤μ‹κ°„ κ°€κ²© μ΅°ν

#### **4.5 ν¬μΈνΈ λ° λ¦¬μ›λ“ κ²½μ **

```
ν¬μΈνΈ μ΅°ν β†’ λ¦¬μ›λ“ μΉ΄νƒλ΅κ·Έ β†’ κµν™ μ”μ²­ β†’ μ™Έλ¶€ λ²¤λ” λ°κΈ‰
```

**API μ—”λ“ν¬μΈνΈ:**

- `GET /users/me/points/balance` - ν¬μΈνΈ μ”μ•΅ μ΅°ν
- `GET /users/me/points/ledger` - ν¬μΈνΈ κ±°λ λ‚΄μ—­
- `GET /rewards/catalog` - λ¦¬μ›λ“ μΉ΄νƒλ΅κ·Έ μ΅°ν
- `POST /rewards/redeem` - ν¬μΈνΈ κµν™ μ”μ²­
- `GET /rewards/history` - κµν™ λ‚΄μ—­ μ΅°ν

#### **4.6 λ°°μΉ λ° μλ™ν™” μ‹μ¤ν…**

```
05:30 μ λ‹λ²„μ¤ μƒμ„± β†’ 06:00 μ •μ‚° β†’ 23:59 μ„Έμ… λ§κ°
```

**API μ—”λ“ν¬μΈνΈ:**

- `POST /batch/universe/create` - μ λ‹λ²„μ¤ μƒμ„± λ°°μΉ
- `POST /batch/session/start` - μ„Έμ… μ‹μ‘ λ°°μΉ
- `POST /batch/session/end` - μ„Έμ… μΆ…λ£ λ°°μΉ
- `POST /batch/schedule/settlement` - μ •μ‚° μ¤μΌ€μ¤„λ§
